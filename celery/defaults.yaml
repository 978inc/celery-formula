{% load_yaml as lookup_map %}
default:
  version: '3.1.23'
  source_hash: 'sha256=2c38b56599edb0a23725dc750d689100fba8519e4de2542146d351e346dfb5c3'
  service: 'celeryd'
  build_dir: /usr/local/src/celery
  working_dir: /tmp/celery/working
  run_dir: /var/run/celery
  log_dir: /tmp/celery/log
  broker: redis
  user: 'celery'
  
Debian: {}
RedHat: {}
{% endload %}

{% load_yaml as broker_defaults %}
url: 'redis://'
pool_limit: 10
connection:
  timeout: 4
  retry: true
  max_retires: 50
{% endload %}

{% load_yaml as celeryd_defaults %}
# Concurrency - change this to add more threads
concurrency: 1
# messages per thread to prefetch
prefetch_multiplier: 1
worker_lost_wait: ~
max_tasks_per_child: 1
task_time_limit: 3600
{% endload %}

{% load_yaml as celery_defaults %}
result_backend: 'redis'
redis_max_connections: 50
message_compression: 'gzip'
accept_content: ['json', 'msgpack']
task:
  # only keep task results for 7 days
  result_expires: {{ 86400 * 7 }}
  serializer: 'msgpack'

imports: []
enable_utc: true
#celery_timezone: 'US/Eastern'

# allows for task.retry (but they need to be idempotent)
acks_late: true
# propagate exceptions within chords
chord_propagate: true
# write down when the task was started by a worker
track_started: true
{% endload %}

{% load_yaml as default_config %}
  broker: {{ broker_defaults }}
  celeryd: {{ celeryd_defaults }}
  celery: {{ celery_defaults }}
{% endload %}
